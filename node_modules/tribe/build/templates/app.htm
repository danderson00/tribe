<!DOCTYPE html>
<html>
<head>
    <title><%= options.appName %></title>

    <% if(data.mobile) { %>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <% } %>

    <% if(options.debug) { %>
    <script type="text/javascript" src="dependencies/jquery/jquery.js"></script>
    <script type="text/javascript" src="dependencies/knockout/knockout-latest.debug.js"></script>
    <script type="text/javascript" src="dependencies/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="dependencies/composite/Tribe.Composite.debug.js"></script>
    <% } else { %>
    <script type="text/javascript" src="dependencies/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="dependencies/knockout/knockout-latest.debug.js"></script> <!-- There is a problem with the way we override the foreach binding - must use debug -->
    <script type="text/javascript" src="dependencies/socket.io/socket.io.js"></script> <!-- TODO: NEED TO MINIFY! -->
    <script type="text/javascript" src="dependencies/composite/Tribe.Composite.min.js"></script>
    <% } %>

    <% for(var list = _.pluck(context.dependencies, 'appPath').sort(), i = 0, l = list.length; i < l; i++) { %>
    <script type="text/javascript" src="<%= list[i] %>"></script>
    <% } %>

    <script type="text/javascript" src="app.js"></script>
    <link rel="stylesheet" type="text/css" href="app.css" />

    <% for(var i = 0, l = context.html.length; i < l; i++) { %>
    <script type="text/template" id="<%= utils.paths.markupIdentifierFor(context.html[i].resourcePath, 'template') %>">
    <%= rewrite(context.html[i].content) %>
    </script>
    <% } %>

    <style>body.__mobile { margin: 0 }</style>

    <script type="text/javascript">
        $(function () {
            require('tribe').initialize(<%= JSON.stringify(options.forBrowser()) %>);
            T.run({ pubsub: require('tribe').pubsub }, <%= JSON.stringify({ startPane: context.startPane }) %>);
        });
    </script>
</head>

<body data-bind="css: { __mobile: <%= (!!(data.mobile)).toString() %> }">
    <div data-bind="pane: { path: startPane.path, data: startPane.data, handlesNavigation: { transition: 'slideLeft' } }"></div>
</body>
</html>
