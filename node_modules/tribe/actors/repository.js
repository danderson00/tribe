var pubsub = require('tribe.pubsub'),
    actorModule = require('tribe.pubsub/actor'),
    log = require('tribe.logger'),
    _ = require('underscore');

var api = module.exports = {
    actors: {},
    register: function (path, constructor) {
        try {
            api.actors[path] = {
                constructor: constructor,
                definition: extractDefinition(path, constructor)
            };
            log.debug('Registered actor ' + path);
        } catch (ex) {
            log.error('Unable to register actor ' + path, ex);
        }
    }
};

function extractDefinition(path, constructor) {
    var actor = new actorModule(pubsub, constructor);
    return {
        path: path,
        expression: actor.metadata.expression,
        isDistributed: actor.metadata.isDistributed,
        topics: _.keys(actor.handles)
    };
}

function createActor(constructor) {
    return new Tribe.PubSub.Actor(pubsub, constructor);
}
