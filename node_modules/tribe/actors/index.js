var repository = require('./repository'),
    extensions = require('./extensions'),
    actorModule = require('tribe.pubsub/actor'),
    _ = require('underscore');

var api = module.exports = {
    actors: repository.actors,
    register: repository.register,
    indexes: function () {
        return _.unique(_.reduce(repository.actors, function (indexes, actor) {
            // we only have the property message filter at the moment
            // we also need to prepend the data property for now, this is a bit nasty
            if (actor.definition.expression)
                indexes.push(actor.definition.expression.p);
            return indexes;
        }, []));
    },
    replay: function (actor, envelopes) {
        _.each(envelopes, function (envelope) {
            if (actor.handles[envelope.topic])
                actor.handles[envelope.topic](envelope.data, envelope);
        });
    },
    create: function (pubsub, path, id) {
        var constructor = repository.actors[path].constructor;
        return new actorModule(pubsub, constructor, id);
    }
};
