var repository = require('./repository'),
    actorModule = require('tribe.pubsub/actor'),
    _ = require('underscore');

var api = module.exports = {
    register: repository.register,
    definition: repository.definition,
    indexes: function () {
        return _.unique(_.reduce(repository.actors, function (indexes, actor) {
            var definition = repository.definition(actor.path);
            if (definition.expression)
                indexes.push(definition.expression.p);
            return indexes;
        }, []));
    },
    create: function (pubsub, path, id, dependencies) {
        var constructor = repository.actor(path).constructor;
        return new actorModule(pubsub, constructor, id, { dependencies: dependencies });
    }
};

require('./extensions')(api);