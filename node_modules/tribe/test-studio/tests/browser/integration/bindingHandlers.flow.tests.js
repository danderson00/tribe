suite('tribe.browser.integration.bindingHandlers.flow', function () {
    test("flow renders start pane", function () {
        var pubsub = require('tribe.pubsub'),
            node = T.appendNode('body', { path: '/tests/flow', pubsub: pubsub }),
            context = T.Utils.contextFor($('body div div'))

            // the initial render of the flow will be async due to it obtaining the underlying actor
        return context.renderOperation.promise.then(function () {
            expect($('span').text()).to.equal('one')
        })
    })

    test("publishing messages triggers navigation", function () {
        var pubsub = require('tribe.pubsub'),
            node = T.appendNode('body', { path: '/tests/flow', pubsub: pubsub })

        return T.Utils.contextFor($('body div div')).renderOperation.promise.then(function () {
            // navigation will occur synchronously in this case (no transition)
            pubsub.publishSync('topic')
            expect($('span').text()).to.equal('two')
        })
    })

    test("scope is passed from bindings", function () {
        var pubsub = require('tribe.pubsub'),
            node = T.appendNode('body', { path: '/tests/flow', data: { value: 'test' }, pubsub: pubsub })

        return T.Utils.contextFor($('body div div')).renderOperation.promise.then(function () {
            pubsub.publishSync('topic', { value: 'test' })
            pubsub.publishSync('topic2', { value: 'test2' })
            expect($('span').text()).to.equal('two')
        })
    })
})
