var services = require('tribe/services'),
    options = require('tribe/options'),
    log = require('tribe/logger'),
    host = require('./host'),
    framework = require('./' + options.test.framework),
    _ = require('underscore');

module.exports = _.extend(framework, {
    initialise: function (asHost) {
        log.info('Loading tests...');

        _.each(options.testPaths, framework.loadDirectory);

        if (asHost) host.start();

        // register the service for retrieving list of tests
        services.register('__tests', function () {
            return {
                fixture: require('tribe/test').tests(),
                inspectorPort: options.inspectorPort,
                debugPort: options.test.debugPort
            };
        });

        return this;
    }
});
