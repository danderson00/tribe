var path = require('path'),
    os = require('os');

// this is to work around the issue described in https://github.com/joyent/node/issues/7031
// it was causing the tribe/actors to be loaded twice and actors were being registered on an inaccessible instance
if (!path.resolve.IS_PATCHED && os.platform().match(/^win/)) {
    var Module = require('module'),
        paths = require('tribe/utilities/paths'),
        originalResolve = Module._resolveFilename;

    Module._resolveFilename = function (request, parent) {
        return paths.ensureConsistentDrive(originalResolve(request, parent));
    };


    var old = path.resolve;

    path.resolve = function pathResolvePath() {
        // execute original function
        var result = old.apply(path, arguments);

        // lowercase the drive letter
        result = result[0].toUpperCase() + result.substr(1);
        return result;
    };

    path.resolve.IS_PATCHED = true;
}