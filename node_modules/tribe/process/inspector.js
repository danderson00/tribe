var fork = require('child_process').fork,
    log = require('tribe.logger');

module.exports = {
    start: function (port) {
        try {
            var inspector = fork(
                    require.resolve('node-inspector/bin/inspector'),
                    ['--web-port=' + port.toString()],
                    { silent: true, execArgv: [] }
                );

            inspector.on('message', handleInspectorMessage);
            //inspector.stdout.on('data', log.log);
            inspector.stderr.on('data', function (data) {
                log.error('Error starting node-inspector');
                log.log(data.toString());
            });

            function handleInspectorMessage(message) {
                switch (message.event) {
                    case 'SERVER.LISTENING':
                        log.info('node-inspector started - visit http://127.0.0.1:' + port + '/debug?ws=127.0.0.1:' + port + '&port=' + process.debugPort + ' to debug server');
                        break;
                    case 'SERVER.ERROR':
                        log.error('Cannot start node-inspector: ' + message.error.code);
                        break;
                }
            }
        } catch (ex) {
            log.info('Unable to load node-inspector - ' + ex.message);
        }
    }
};
