var options = require('tribe/options'),
    pubsub = require('tribe.pubsub'),
    log = require('tribe/logger'),

    // added for hack
    utils = require('tribe/utilities'),
    path = require('path'),

    modulePath = process.argv[2];
    passedOptions = JSON.parse(process.argv[3]);

options.apply(passedOptions);
options.childProcess = true;

pubsub.subscribe('*', function (data, envelope) {
    if (envelope.origin !== 'parent')
        process.send(envelope);
});

process.on('message', function (envelope) {
    envelope.origin = 'parent';
    pubsub.publish(envelope);
});

log.info('Process for ' + modulePath + ' started.');
require(modulePath);
