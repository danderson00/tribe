var hub = require('./hub'),
    serializer = require('tribe/utilities/serializer'),
    pubsub = require('tribe.pubsub/pubsub'),
    actorModule = require('tribe.pubsub/actor'),
    channel = require('tribe.pubsub/channel'),
    lifetime = require('tribe.pubsub/lifetime');

pubsub.prototype.obtainActor = function (path, id) {
};

pubsub.prototype.startActor = function (path, id, data) {
    if (path.charAt(0) !== '/')
        path = '/' + path;

    var actor = new actorModule(this, actorDefinition(path), id);

    if (actor.metadata.isDistributed)
        attachToHub(path, actor);

    return actor.start(data);
};

function actorDefinition(path) {
    return T.context().actors[path].constructor;
}

// need to also be able to detach
function attachToHub(path, actor) {
    hub.subscribe(path, actor.id);
    actor.pubsub.subscribe(actor.topics, function (message, envelope) {
        envelope.actorId = actor.id;
        hub.publish(envelope);
    });
}

lifetime.prototype.startActor = pubsub.prototype.startActor;
lifetime.prototype.resumeActor = pubsub.prototype.resumeActor;
