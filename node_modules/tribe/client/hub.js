var pubsub = require('tribe.pubsub'),
    socket;

var hub = module.exports = {
    connect: function () {
        socket = io.connect();

        socket.on('message', function (envelope) {
            envelope.origin = 'server';
            pubsub.publish(envelope);
        });
    },

    publish: function(envelope) {
        if (!socket) hub.connect();

        if(envelope.origin !== 'server')
            socket.emit('message', envelope, function () {
                //console.log('message acknowledged');
            });
    },

    subscribe: function (actorPath, id) {
        if (!socket) hub.connect();
        setTimeout(function () {
            socket.emit('subscribe', { actor: actorPath, id: id }, function () {
                console.log('actor subscribed');
            });
        });
    }
};