suite('tribe.eventStore.sqlite3.database', function () {
    var database = require('tribe/eventStore/sqlite3/database');

    setup(function () {
        database.close();
    });

    test("initialise creates messages table", function () {
        return database.initialise()
            .then(function () {
                return database.serialise(function (db, fail) {
                    db.exec("select * from messages", fail);
                });
            });
    });

    // should probably test for creation of indexes
    test("initialise with indexes creates columns", function () {
        return database.initialise(['testId'])
            .then(function () {
                return database.serialise(function (db, fail) {
                    db.exec("select * from messages where testId = 1", fail);
                });
            });
    });

    test("initialise with new indexes creates new columns", function () {
        return database.initialise(['testId'])
            .then(function () {
                return database.initialise(['test2Id']);
            })
            .then(function () {
                return database.serialise(function (db, fail) {
                    db.exec("select * from messages where testId = 1 and test2Id = 1", fail);
                });
            });
    });
});
