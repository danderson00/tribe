suite('tribe.eventStore.sqlite3.initialise', function () {
    var initialise = require('tribe/eventStore/sqlite3/initialise'),
        database = require('tribe/eventStore/sqlite3/database');

    setup(function () {
        database.open(':memory:');
    });

    teardown(database.close);

    test("initialise creates messages table", function () {
        return initialise(database)
            .then(function () {
                return database.serialise(function (db, fail) {
                    db.exec("select * from messages", fail);
                });
            });
    });

    // should probably test for creation of actual indexes
    test("initialise with indexes creates columns", function () {
        return initialise(database, ['testId'])
            .then(function () {
                return database.serialise(function (db, fail) {
                    db.exec("select * from messages where testId = 1", fail);
                });
            });
    });

    test("initialise with new indexes creates new columns", function () {
        return initialise(database, ['testId'])
            .then(function () {
                return initialise(database, ['test2Id']);
            })
            .then(function () {
                return database.serialise(function (db, fail) {
                    db.exec("select * from messages where testId = 1 and test2Id = 1", fail);
                });
            });
    });
});
