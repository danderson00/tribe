var Q = require('q'),
    _ = require('underscore');

createSuite({ name: 'sqlite3', filename: ':memory:' });

function createSuite(options) {
    var store = require('tribe/eventStore');

    suite('tribe.eventStore.integration.' + options.name, function () {
        // this is really basic, probably requires more comprehensive testing
        test("basic store and retrieve", function () {
            return store.initialise(options, ['test1', 'test2'])
            .then(function () {
                return Q.all([
                    store.store({ topic: 'topic', data: { test1: 1, test2: 'a' } }),
                    store.store({ topic: 'topic', data: { test1: 2, test2: 'b' } }),
                    store.store({ topic: 'topic', data: { test1: 3, test2: 'a' } }),
                    store.store({ topic: 'topic', data: { test1: 1, test2: 'b' }, test3: 'test' })
                ]);
            }).then(function (ids) {
                expect(ids).to.deep.equal([1, 2, 3, 4]);
                return store.retrieve({ indexName: 'test1', indexValue: 1 });
            }).then(function (envelopes) {
                expect(envelopes.length).to.equal(2);
                expect(envelopes[0]).to.deep.equal({ topic: 'topic', data: { test1: 1, test2: 'a' }, id: 1 });
                expect(envelopes[1]).to.deep.equal({ topic: 'topic', data: { test1: 1, test2: 'b' }, test3: 'test', id: 4 });
            });
        });
    });
}