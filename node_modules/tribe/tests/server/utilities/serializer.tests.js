var serializer = require('tribe/utilities/serializer');

suite('tribe.utilities.serializer', function () {
    test("extractMetadata adds observables to metadata", function () {
        var result = serializer.extractMetadata({
            p1: 1,
            p2: ko.observable(2),
            p3: ko.observableArray()
        });
        expect(result.metadata.observables).to.deep.equal(['p2', 'p3']);
    });

    test("extractMetadata resolves observables on target", function () {
        var result = serializer.extractMetadata({
            p1: 1,
            p2: ko.observable(2),
            p3: ko.observableArray()
        });
        expect(result.target.p2).to.equal(2);
        expect(result.target.p3).to.deep.equal([]);
    });

    test("applyMetadata converts target values to observables", function () {
        var result = serializer.applyMetadata({
            p1: 1,
            p2: 2,
            p3: [3]
        }, { observables: ['p2', 'p3'] });
        expect(ko.isObservable(result.p2)).to.be.true;
        expect(ko.isObservable(result.p3)).to.be.true;
        expect(result.p3.push).to.be.a('function');
        expect(result.p1).to.equal(1);
        expect(result.p2()).to.equal(2);
        expect(result.p3()[0]).to.equal(3);
    });
});
