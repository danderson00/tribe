var fs = require('q-io/fs'),
    log = require('tribe/logger'),
    serializer = require('tribe/utilities/serializer'),

    api = module.exports = {
        put: function(partitionKey, rowKey, data) {
            return fs.makeTree(targetFolder(partitionKey))
                .then(writeFile)
                .fail(log.error);

            function writeFile() {
                return fs.write(targetFile(partitionKey, rowKey), serializer.serialize(data))
                    .fail(log.error);
            }
        },
        get: function(partitionKey, rowKey) {
            return fs.read(targetFile(partitionKey, rowKey))
                .then(serializer.deserialize)
                .fail(log.error);
        },
        basePath: __dirname
    };
    
function targetFolder(partitionKey) {
    return api.basePath + '/' + partitionKey;
}
    
function targetFile(partitionKey, rowKey) {
    return api.basePath + '/' + partitionKey + '/' + rowKey + '.json';
}
