var Q = require('q'),
    _ = require('underscore'),
    stores = {
        sqlite3: require('./sqlite3'),
        //indexeddb: require('./indexeddb')
    };

module.exports = function (entities, options) {
    var store = stores[options.type];

    return store.open(options, entities).then(function () {
        return {
            entity: function (name) {
                return store.entityContainer(name, _.findWhere(entities, { name: name }).indexes);
            }
        };
    });
}