var Q = require('q');

module.exports = function (db, name, args) {
    var promise = Q.defer(),
        cursor = db.transaction([name]).objectStore(name).openCursor(args),
        results = [];

    cursor.onsuccess = function (event) {
        var result = event.target.result;
        if (result) {
            results.push(result.value);
            result.continue();
        }
        else
            promise.resolve(results);
    };

    cursor.onerror = function (event) {
        promise.reject(this.error);
    };

    return promise.promise;
};
