var uuid = require('node-uuid')

require('tribe.graphs')

suite('tribe.graphs.incremental', function () {
    test("graph, axes and lines are created", function () {
        var node = T.createNode('body', { 
            path: 'graph',
            scope: { testId: uuid() }, 
            data: { groups: e => e.groupBy(x => x.data.playerId), values: e => e.topic('point').count() }
        })

        return node.pane.is.rendered.then(function () {
            // the incremental graph is a bit crude and expects groups to be created before points are published
            node.pane.pubsub.publish('player.selected', { playerId: '1' })
            node.pane.pubsub.publish('player.selected', { playerId: '2' })
            node.pane.pubsub.publish('point', { playerId: '1' })
            expect($('.graph').length).to.equal(1)
            expect($('.axis').length).to.equal(2)
            expect($('.line').length).to.equal(2)
        })
    })
})
