require('./filters')(Query)
require('./projections')(Query)

module.exports = function () {
    return new Query()
}

function Query() {
    this.filters = []
    this.projections = []
    this.type = 'object'
}

Query.prototype.evaluate = function (object) {
    if (this.filters.every(passes))
        return this.projections.reduce(project, object)

    function passes(filter) {
        return filter(object)
    }

    function project(value, projection) {
        return projection(value)
    }
}
