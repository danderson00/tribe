var Rx = require('rx')
require('../Observable.overrides')

suite('tribe.rx.Observable.overrides', function () {
    var source;

    setup(function () {
        source = new Rx.Subject()
    })

    test("count with no predicate", function () {
        testObservable(source.count(), [undefined, undefined], [1, 2])
    })

    test("count with predicate", function () {
        testObservable(source.count(function (x) { return x > 3 }), [4, 2, 5], [1, 2])
    })

    test("sum with no predicate", function () {
        testObservable(source.sum(), [2, 3], [2, 5])
    })

    test("sum with predicate", function () {
        testObservable(source.sum(function (x) { return x.value }), [{ value: 2 }, { value: 3 }], [2, 5])
    })

    function testObservable(observable, values, expectedValues) {
        var spy = sinon.spy()

        observable.subscribe(spy)
        values.forEach(function (value) {
            source.onNext(value)
        })
        expectedValues.forEach(function (value, index) {
            expect(spy.getCall(index).args[0]).to.equal(value)
        })
    }
})
