var store = require('tribe/client/eventStore')
require('../..')

suite('tribe.rx.browser.integration', function () {
    test("query retrieves messages by topic", function () {
        $('#template--rx-query').remove()
        $('head').append('<script type="text/template" id="template--rx-query"><ul data-bind="foreach: query(\'t1\')"><li /></ul></script>')

        return store.clear()
            .then(function () {
                return store.store({}, [{ topic: 't1', data: 1 }, { topic: 't1', data: 2 }, { topic: 't2', data: 3 }])
            })
            .then(function () {
                var node = T.createNode('body', { path: '/rx/query' })
                return node.pane.is.rendered;
            })
            .then(function () {
                expect($('li').length).to.equal(2)                
            })
    })
})
