var Facet = require('tribe.pubsub/facet'),
    Pubsub = require('tribe.pubsub/pubsub'),
    pubsub;

require('..')

suite('tribe.rx.integration', function () {
    setup(function () {
        pubsub = new Pubsub({ sync: true, handleExceptions: false });
    });

    test("facet containing multiple when predicates fires the correct number of times", function () {
        var spy1 = sinon.spy(),
            spy2 = sinon.spy(),
            facet = new Facet(pubsub, constructor)

        facet.start()

        pubsub.publish('topic')
        expect(spy1.callCount).to.equal(1)
        expect(spy2.callCount).to.equal(0)

        pubsub.publish('topic')
        expect(spy1.callCount).to.equal(1)
        expect(spy2.callCount).to.equal(1)

        function constructor(facet) {
            facet.topic('topic').count()
                .when(1).then(spy1)
                .when(2).then(spy2)
        }
    })
})
