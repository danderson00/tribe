var Actor = require('tribe.pubsub/actor'),
    Pubsub = require('tribe.pubsub/pubsub'),
    pubsub;

require('..')

suite('tribe.rx.integration', function () {
    setup(function () {
        pubsub = new Pubsub({ sync: true, handleExceptions: false });
    });

    test("actor containing multiple when predicates fires the correct number of times", function () {
        var spy1 = sinon.spy(),
            spy2 = sinon.spy(),
            actor = new Actor(pubsub, constructor)

        actor.start()

        pubsub.publish('topic')
        expect(spy1.callCount).to.equal(1)
        expect(spy2.callCount).to.equal(0)

        pubsub.publish('topic')
        expect(spy1.callCount).to.equal(1)
        expect(spy2.callCount).to.equal(1)

        function constructor(actor) {
            actor.topic('topic').count()
                .when(1).then(spy1)
                .when(2).then(spy2)
        }
    })
})
