var Rx = require('rx'),
    actor = require('tribe.pubsub/actor')

T.Events.addRxToModel = function (pane, context) {
    if(!pane.model.hasOwnProperty('messages')) {
        pane.model.__defineGetter__('messages', function () {
            return paneActor().messages
        })
    }

    if(!pane.model.topic) {
        pane.model.topic = function (topic) {
            return paneActor().envelopes
                .where(function (x) { return x.topic === topic })
                .select(function (x) { return x.data })
        }
    }

    function paneActor() {
        if(!pane.__generatedActor) {
            pane.__generatedActor = new actor(pane.pubsub, constructor)
            // this blocks renderComplete until completed
            context.renderOperation.add(pane.__generatedActor)
        }
        return pane.__generatedActor

        function constructor(actor) {
            actor.isDistributed && actor.isDistributed()
        }
    }
}
