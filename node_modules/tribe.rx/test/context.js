var Pubsub = require('tribe.pubsub/pubsub'),
    Rx = require('rx')

module.exports = function () {
    var pubsub = new Pubsub({ sync: true })
    return {
        pubsub: pubsub,
        envelopes: createObservable()
    }

    function createObservable() {
        return Rx.Observable.create(function (observer) {
            pubsub.subscribe('*', function (data, envelope) {
                observer.onNext(envelope)
            })
        })
    }
}
