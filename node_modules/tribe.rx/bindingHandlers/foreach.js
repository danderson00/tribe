// purely sugar to automatically call asArray on Rx observables
var oldForeachBinding = ko.bindingHandlers.foreach
ko.bindingHandlers.foreach = {
    init: function(element, valueAccessor) {
        return oldForeachBinding.init(element, makeForeachValueAccessor(valueAccessor));
    },
    update: function(element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
        return oldForeachBinding.update(element, makeForeachValueAccessor(valueAccessor), allBindingsAccessor, viewModel, bindingContext);
    },
    makeTemplateValueAccessor: oldForeachBinding.makeTemplateValueAccessor
}

function makeForeachValueAccessor(valueAccessor) {
    var value = valueAccessor()
    if(value && value.asArray) value = value.asArray()
    return function () {
        return value
    }
}
