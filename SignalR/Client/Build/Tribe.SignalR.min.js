Tribe=window.Tribe||{},Tribe.SignalR=Tribe.SignalR||{},Tribe.SignalR.Client=function(e,t,n){var i,a=this;t.client.acceptServerMessage=function(t){var n=JSON.parse(t);n.server=!0,n.sync=!0,e.publish(n)},this.publishToServer=function(e,t,a){$.when(i).done(function(){n.publishToServer(e,t,a)})},this.joinChannel=function(n,r){function d(){o.serverEvents&&o.serverEvents.length>0&&(s=e.createLifetime(),s.subscribe(o.serverEvents,function(e,t){a.publishToServer(n,t,o.record)}))}var s,o=r===!0?{replay:!0}:r||{};return i||(i=$.connection.hub.start()),$.when(i).done(function(){t.server.joinChannel(n),o.replay&&t.server.replayChannel(n)}),d(),{leave:function(){s&&s.end(),a.leaveChannel(n)}}},this.leaveChannel=function(e){i&&$.when(i).done(function(){t.server.leaveChannel(e)})}},function(){function e(){throw"Tribe.SignalR must be initialised before use by calling TMH.initialise(pubsub, url)"}function t(e){function n(e,t){return function(){t.apply(e,$.makeArray(arguments))}}function a(e,t){var a,i,r,s,o;for(a in e)if(e.hasOwnProperty(a)){if(i=e[a],!i.hubName)continue;o=t?i.on:i.off;for(r in i.client)if(i.client.hasOwnProperty(r)){if(s=i.client[r],!$.isFunction(s))continue;o.call(i,r,n(i,s))}}}var t=$.signalR;$.hubConnection.prototype.createHubProxies=function(){var e={};return this.starting(function(){a(e,!0),this._registerSubscribedHubs()}).disconnected(function(){a(e,!1)}),e.hubImplementation=this.createHubProxy("hubImplementation"),e.hubImplementation.client={},e.hubImplementation.server={publish:function(){return e.hubImplementation.invoke.apply(e.hubImplementation,$.merge(["Publish"],$.makeArray(arguments)))},joinChannel:function(){return e.hubImplementation.invoke.apply(e.hubImplementation,$.merge(["JoinChannel"],$.makeArray(arguments)))},replayChannel:function(){return e.hubImplementation.invoke.apply(e.hubImplementation,$.merge(["ReplayChannel"],$.makeArray(arguments)))},leaveChannel:function(){return e.hubImplementation.invoke.apply(e.hubImplementation,$.merge(["LeaveChannel"],$.makeArray(arguments)))}},e},t.hub=$.hubConnection(e,{useDefaultPath:!1}),$.extend(t,t.hub.createHubProxies())}"function"!=typeof $.signalR&&window.console&&window.console.log&&window.console.log("SignalR: SignalR is not loaded. Please ensure jquery.signalR-x.js is referenced before Tribe.js"),window.TMH={initialise:function(e,n){t(n||"signalr"),$.extend(TMH,new Tribe.SignalR.Client(e,$.connection.hubImplementation,new Tribe.SignalR.Publisher($.connection.hubImplementation)))},publishToServer:e,joinChannel:e,leaveChannel:e}}(),Tribe=window.Tribe||{},Tribe.SignalR=Tribe.SignalR||{},Tribe.SignalR.Publisher=function(e){function a(e,a){n.push(function(){t.publishToServer(e,a)})}function i(){if(n.length>0){var e=n;n=[],$.each(e,function(e,t){t()})}}function r(t){return t?t===$.signalR.connectionState.connected:e.connection.state===$.signalR.connectionState.connected}var t=this,n=[];this.publishToServer=function(t,n,i){n.server||(r()?e.server.publish(t,JSON.stringify(n),i===!0):a(t,n))},e.connection.stateChanged(function(e){r(e.newState)&&i()})},Tribe.PubSub.prototype.joinChannel=function(e,t){TMH.joinChannel(e,t)},Tribe.PubSub.Lifetime.prototype.joinChannel=function(e,t){var n=this.end,a=TMH.joinChannel(e,t);this.end=function(){a.leave(),n()}};