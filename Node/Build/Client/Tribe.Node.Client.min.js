"undefined"==typeof T&&(T={}),T.Types=T.Types||{},function(){function e(e){return TC.context().sagas[e].constructor}function t(e){T.hub.join(e.id),e.pubsub.subscribe(e.topics,function(t,n){n.sagaId=e.id,T.hub.publish(n)})}Tribe.PubSub.prototype.startSaga=function(n,a,i){"/"!==a.charAt(0)&&(a="/"+a);var r=new Tribe.PubSub.Saga(this,e(a));return r.id=n,t(r),T.hub.startSaga(a,n,i),r.start(i)},Tribe.PubSub.prototype.joinSaga=function(n,a,i){var r=$.Deferred(),s=this;return $.when($.get("/Data/"+n+"/"+n)).done(function(a){var i=new Tribe.PubSub.Saga(s,e(a.path));i.id=n,i.join(T.serializer.deserialize(a.data)),t(i),r.resolve(i)}).fail(function(e){if(404===e.status&&a){var t=s.startSaga(n,a,i);r.resolve(t)}else r.reject(e)}),r},Tribe.PubSub.Lifetime.prototype.startSaga=Tribe.PubSub.prototype.startSaga,Tribe.PubSub.Lifetime.prototype.joinSaga=Tribe.PubSub.prototype.joinSaga,Tribe.PubSub.Channel.prototype.connect=function(e){var t=this;T.hub.join(this.id),this.subscribe(e||"*",function(e,t){T.hub.publish(t)});var n=this.end;return this.end=function(){T.hub.leave(t.channelId),n()},this}}(),T.Types.Hub=function(e,t,n){var a=e.connect(n.socketUrl);a.on("message",function(e){e.origin="server",t.publish(e)}),this.publish=function(e){if(!a)throw"Hub must be connected before calling publish";"server"!==e.origin&&a.emit("message",e)},this.join=function(e){a.emit("join",e)},this.startSaga=function(e,t,n){a.emit("startSaga",{path:e,id:t,data:n})}};