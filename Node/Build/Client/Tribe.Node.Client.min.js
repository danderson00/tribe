"undefined"==typeof T&&(T={}),T.Types=T.Types||{},function(){function t(t){return T.context().sagas[t].constructor}function e(t){T.hub.join(t.id),t.pubsub.subscribe(t.topics,function(e,n){n.sagaId=t.id,T.hub.publish(n)})}Tribe.PubSub.prototype.startSaga=function(n,i,r){"/"!==i.charAt(0)&&(i="/"+i);var o=new Tribe.PubSub.Saga(this,t(i));return o.id=n,e(o),T.hub.startSaga(i,n,r),o.start(r)},Tribe.PubSub.prototype.joinSaga=function(n,i,r){var o=$.Deferred(),a=this;return $.when($.get("/Data/"+n+"/"+n)).done(function(i){var r=new Tribe.PubSub.Saga(a,t(i.path));r.id=n,r.join(T.serializer.deserialize(i.data)),e(r),o.resolve(r)}).fail(function(t){if(404===t.status&&i){var e=a.startSaga(n,i,r);o.resolve(e)}else o.reject(t)}),o},Tribe.PubSub.Lifetime.prototype.startSaga=Tribe.PubSub.prototype.startSaga,Tribe.PubSub.Lifetime.prototype.joinSaga=Tribe.PubSub.prototype.joinSaga,Tribe.PubSub.Channel.prototype.startSaga=Tribe.PubSub.prototype.startSaga,Tribe.PubSub.Channel.prototype.joinSaga=Tribe.PubSub.prototype.joinSaga,Tribe.PubSub.Channel.prototype.connect=function(t){var e=this;T.hub.join(this.id),this.subscribe(t||"*",function(t,e){T.hub.publish(e)});var n=this.end;return this.end=function(){T.hub.leave(e.channelId),n()},this}}(),T.Types.Hub=function(t,e,n){var i=t.connect(n.socketUrl);i.on("message",function(t){t.origin="server",e.publish(t)}),this.publish=function(t){if(!i)throw"Hub must be connected before calling publish";"server"!==t.origin&&i.emit("message",t)},this.join=function(t){i.emit("join",t)},this.startSaga=function(t,e,n){i.emit("startSaga",{path:t,id:e,data:n})}};