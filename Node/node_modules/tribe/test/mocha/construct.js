var Mocha = require('mocha'),
    _ = require('underscore');

module.exports = {
    suite: constructSuite
};

function constructSuite(mocha, tests) {
    var suite = new Mocha.Suite('', new Mocha.Context);
    _.each(tests, function (test) {
        var testSuite = Mocha.Suite.create(suite, test.fixture.join('.')),
            actualTest = findTest(mocha, test);
        
        testSuite.addTest(new Mocha.Test(actualTest.title, actualTest.originalFn || actualTest.fn));
    });
    return suite;
}

function findTest(mocha, test) {
    var testSuite = _.reduce(test.fixture, function (suite, title) {
        return _.findWhere(suite.suites, { title: title });
    }, mocha.suite);
    return _.findWhere(testSuite.tests, { title: test.title });
}
