suite('tribe.test.mocha.loader', function () {
    var Mocha = require('mocha'),
        mocha = new Mocha(),
        loader,
        restore;

    setup(function () {
    });

    teardown(restore);

    test("addTest override creates tests and sets filename", function () {
        require.forceRefresh();
        require.stub('tribe/server/channels', { broadcastTo: function () { } });
        require.stub('tribe/load', {
            file: function (options) {
                options.beforeExecute();
                restore = options.afterExecute;
                return { fail: function () { } };
            }
        });
        mocha = new Mocha();
        loader = require('tribe/test/mocha/loader');
        loader.loadFile(mocha, 'path');

        mocha.suite.addTest(new Mocha.Test('title', function () { }));
        mocha.suite.addTest(new Mocha.Test('title2', function () { }));
        expect(mocha.suite.tests.length).to.equal(2);
        expect(mocha.suite.tests[0].title).to.equal('title');
        expect(mocha.suite.tests[0].filename).to.equal('path');
    });

    test("addTest override replaces existing tests", function () {
        require.forceRefresh();
        require.stub('tribe/server/channels', { broadcastTo: function () { } });
        require.stub('tribe/load', {
            file: function (options) {
                options.beforeExecute();
                restore = options.afterExecute;
                return { fail: function () { } };
            }
        });
        mocha = new Mocha();
        loader = require('tribe/test/mocha/loader');
        loader.loadFile(mocha, 'path');

        mocha.suite.addTest(new Mocha.Test('title', function () { }));
        mocha.suite.addTest(new Mocha.Test('title', function () { }));
        expect(mocha.suite.tests.length).to.equal(1);
        expect(mocha.suite.tests[0].title).to.equal('title');
    });
});