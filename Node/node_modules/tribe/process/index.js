var cp = require('child_process'),
    options = require('tribe/options'),
    pubsub = require('tribe/pubsub'),
    log = require('tribe/logger');

module.exports = {
    start: function (path, debugPort) {
        var args = [];
        if (debugPort) args.push('--debug-brk=' + debugPort);
        args.push(require.resolve('./bootstrapper'));
        args.push(path);
        args.push(JSON.stringify(options));

        var runner = cp.spawn(process.execPath, args, { stdio: ['pipe', 'pipe', 'pipe', 'ipc'] });
        runner.on('message', pubsub.publish);
        runner.stdout.on('data', log.debug);
        runner.stderr.on('data', log.error);
    }
};
