var fork = require('child_process').fork,
    log = require('tribe/logger');

module.exports = {
    start: function (port) {
        var inspectorArgs = ['--web-port', port],
            forkOptions = { silent: true },
            inspector = fork(
                require.resolve('node-inspector/bin/inspector'),
                inspectorArgs,
                forkOptions
            );

        inspector.on('message', handleInspectorMessage);
        //inspector.stdout.on('data', log);
        inspector.stderr.on('data', log.error);

        function handleInspectorMessage(message) {
            switch (message.event) {
                case 'SERVER.LISTENING':
                    log.debug('node-inspector listening on port ' + port);
                    break;
                case 'SERVER.ERROR':
                    log.error('Cannot start node-inspector: ' + message.error.code);
                    break;
            }
        }
    }
};