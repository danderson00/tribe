// Dependencies/jquery.lw-datepicker.js
// Generated by CoffeeScript 1.2.1-pre

/*!
 * Lightweight DatePicker - jQuery Plugin
 * Provides themeable and customizable date picker
 *
 * Â© 2011 Maxim Zhukov (zhkv.mxm@gmail.com)
 * 
 * Version: 1.1
 * Requires: jQuery v1.6+
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
*/


(function() {
  var $, LightweightDatepicker, compareDates, isDateValid, lw_dp_active_day_class, lw_dp_class, lw_dp_data_key, lw_dp_dows_class, lw_dp_dows_last_column_class, lw_dp_firstweek_class, lw_dp_hidden_class, lw_dp_lastweek_class, lw_dp_month_class, lw_dp_neighbour_month_day_class, lw_dp_next_class, lw_dp_out_of_interval_class, lw_dp_previous_class, lw_dp_today_class, lw_dp_toolbar_class, lw_dp_week_class, lw_dp_week_last_column_class, lw_dp_weekend_class, settings,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  $ = jQuery;

  settings = {
    'startDate': null,
    'endDate': null,
    'dowNames': ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
    'monthNames': ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
    'firstDayOfTheWeekIndex': 0,
    'autoFillToday': false,
    'alwaysVisible': false,
    'autoHideAfterClick': false,
    'parseDate': null,
    'formatDate': null,
    'onChange': null
  };

  lw_dp_class = 'lw-dp';

  lw_dp_active_day_class = 'lw-dp-active-day';

  lw_dp_dows_class = 'lw-dp-dows';

  lw_dp_dows_last_column_class = 'lw-dp-dows-last-column';

  lw_dp_firstweek_class = 'lw-dp-firstweek';

  lw_dp_hidden_class = 'lw-dp-hidden';

  lw_dp_lastweek_class = 'lw-dp-lastweek';

  lw_dp_month_class = 'lw-dp-month';

  lw_dp_neighbour_month_day_class = 'lw-dp-neighbour-month-day';

  lw_dp_next_class = 'lw-dp-next';

  lw_dp_out_of_interval_class = 'lw-dp-out-of-interval';

  lw_dp_previous_class = 'lw-dp-previous';

  lw_dp_today_class = 'lw-dp-today';

  lw_dp_toolbar_class = 'lw-dp-toolbar';

  lw_dp_week_class = 'lw-dp-week';

  lw_dp_week_last_column_class = 'lw-dp-week-last-column';

  lw_dp_weekend_class = 'lw-dp-weekend';

  lw_dp_data_key = 'lw-datepicker';

  compareDates = function(date1, date2) {
    if (date1.getFullYear() < date2.getFullYear()) return -1;
    if (date1.getFullYear() > date2.getFullYear()) return 1;
    if (date1.getMonth() < date2.getMonth()) return -1;
    if (date1.getMonth() > date2.getMonth()) return 1;
    if (date1.getDate() < date2.getDate()) return -1;
    if (date1.getDate() > date2.getDate()) return 1;
    return 0;
  };

  isDateValid = function(date) {
    if (Object.prototype.toString.call(date) !== '[object Date]') return false;
    return !isNaN(date.getTime());
  };

  LightweightDatepicker = (function() {

    LightweightDatepicker.name = 'LightweightDatepicker';

    LightweightDatepicker.prototype.canShowPreviousMonth = true;

    LightweightDatepicker.prototype.canShowNextMonth = true;

    LightweightDatepicker.prototype.shouldHide = true;

    function LightweightDatepicker(el, settings) {
      this.destroy = __bind(this.destroy, this);

      this._handleKeyDown = __bind(this._handleKeyDown, this);

      this.showNextMonth = __bind(this.showNextMonth, this);

      this.showPreviousMonth = __bind(this.showPreviousMonth, this);

      this.show = __bind(this.show, this);

      this.hide = __bind(this.hide, this);

      this._isDateInsidePeriod = __bind(this._isDateInsidePeriod, this);

      this.setCurrentDate = __bind(this.setCurrentDate, this);

      this.setActiveDate = __bind(this.setActiveDate, this);

      this._updateMonth = __bind(this._updateMonth, this);

      this._getDateFromElement = __bind(this._getDateFromElement, this);

      this._onChange = __bind(this._onChange, this);

      this._onClick = __bind(this._onClick, this);
      this.input = el;
      this.input.bind('focus', this.show);
      this.input.bind('blur', this.hide);
      this.input.bind('keydown', this._handleKeyDown);
      this.input.bind('change', this._onChange);
      this.input.bind('click', this._onClick);
        //this.isIE = $.browser.msie && parseInt($.browser.version, 10) <= 8;
      this.isIE = (window.attachEvent && !window.addEventListener);
      this.input.data(lw_dp_data_key, this);
      this.settings = {
        startDate: settings['startDate'],
        endDate: settings['endDate'],
        dowNames: settings['dowNames'],
        monthNames: settings['monthNames'],
        firstDayOfTheWeekIndex: settings['firstDayOfTheWeekIndex'],
        autoFillToday: settings['autoFillToday'],
        alwaysVisible: settings['alwaysVisible'],
        autoHideAfterClick: settings['autoHideAfterClick'],
        parseDate: settings['parseDate'],
        formatDate: settings['formatDate'],
        onChange: settings['onChange']
      };
      this.todayDate = new Date;
      this.currentDate = this.settings.startDate || new Date;
      this._createDatepicker();
      if (this.settings.autoFillToday && this._isDateInsidePeriod(new Date)) {
        this.activeDate = new Date;
      }
      this.setActiveDate(this._parseDate(this.input.val()));
      if (this.settings.alwaysVisible) {
        this.wrapper.insertAfter(this.input);
      } else {
        this.wrapper.appendTo(document.body);
      }
      this.margin = parseInt(this.wrapper.css('margin-top'), 10);
      this.wrapper.css('margin', 0);
      this._bindEvents();
      if (this.settings.alwaysVisible) this.updatePosition();
      this.updateInput();
      this._updateMonth();
      this.hide();
    }

    LightweightDatepicker.prototype._onClick = function() {
      if (!$("." + lw_dp_class).has(this.wrapper).length) return this.show();
    };

    LightweightDatepicker.prototype._onChange = function() {
      if (this.updatingInput) return;
      return this.setActiveDate(this._parseDate(this.input.val()));
    };

    LightweightDatepicker.prototype._createDatepicker = function() {
      this.wrapper = $("<div class=" + lw_dp_class + "/>");
      this.toolbar = $("<div class=" + lw_dp_toolbar_class + "/>").appendTo(this.wrapper);
      this.previous = $("<div class=" + lw_dp_previous_class + "/>").appendTo(this.toolbar);
      this.next = $("<div class=" + lw_dp_next_class + "/>").appendTo(this.toolbar);
      this.month = $("<div class=" + lw_dp_month_class + "/>").appendTo(this.toolbar);
      this._renderDows().appendTo(this.wrapper);
      return this.days = $('<div/>').appendTo(this.wrapper);
    };

    LightweightDatepicker.prototype._bindEvents = function() {
      var event,
        _this = this;
      this.wrapper.bind('mousedown touchstart', function(e) {
        e.preventDefault();
        e.stopPropagation();
        if (_this.isIE) return _this.shouldHide = false;
      });
      event = this.isIE ? 'mousedown' : 'click touchstart';
      this.toolbar.delegate("." + lw_dp_next_class, event, this.showNextMonth);
      this.toolbar.delegate("." + lw_dp_previous_class, event, this.showPreviousMonth);
      return this.days.delegate("li:not(." + lw_dp_active_day_class + "):not(." + lw_dp_out_of_interval_class + ")", event, function(e) {
        var currentLi;
        currentLi = $(e.currentTarget);
        _this.setActiveDate(_this._getDateFromElement(currentLi));
        if (_this.settings.autoHideAfterClick) _this.hide();
        if (typeof _this.settings.onChange === 'function') {
          _this.settings.onChange(_this.activeDate, _this.input);
        }
        return false;
      });
    };

    LightweightDatepicker.prototype._getDateFromElement = function(el) {
      var currentDay, currentMonth, currentYear, diff;
      currentDay = el.text();
      currentYear = this.currentDate.getFullYear();
      diff = 0;
      if (el.hasClass(lw_dp_neighbour_month_day_class)) {
        diff = currentDay > 10 ? -1 : 1;
      }
      currentMonth = this.currentDate.getMonth() + diff;
      return new Date(currentYear, currentMonth, currentDay);
    };

    LightweightDatepicker.prototype.updateInput = function() {
      this.input.val(this._formatDate(this.activeDate));
      this.updatingInput = true;
      this.input.trigger('change');
      return this.updatingInput = false;
    };

    LightweightDatepicker.prototype._updateMonth = function() {
      var cd, date, day, daysInFirstWeek, daysInMonth, daysInPreviousMonth, firstDayDow, firstDayOfNextMonth, html, lastDayOfPreviousMonth, lastDowIndex, renderDay, week, weeks, _i, _j,
        _this = this;
      this.month.html(this.settings.monthNames[this.currentDate.getMonth()] + ', ' + this.currentDate.getFullYear());
      cd = this.currentDate;
      lastDayOfPreviousMonth = new Date(cd.getFullYear(), cd.getMonth(), 0);
      if ((this.settings.startDate != null) && lastDayOfPreviousMonth.getTime() < this.settings.startDate.getTime()) {
        this.canShowPreviousMonth = false;
        $(this.previous).hide();
      } else {
        this.canShowPreviousMonth = true;
        $(this.previous).show();
      }
      firstDayOfNextMonth = new Date(cd.getFullYear(), cd.getMonth() + 1, 1);
      if ((this.settings.endDate != null) && firstDayOfNextMonth.getTime() > this.settings.endDate.getTime()) {
        this.canShowNextMonth = false;
        $(this.next).hide();
      } else {
        this.canShowNextMonth = true;
        $(this.next).show();
      }
      firstDayDow = (new Date(cd.getFullYear(), cd.getMonth(), 1)).getDay();
      lastDowIndex = (this.settings.firstDayOfTheWeekIndex + 6) % 7;
      daysInFirstWeek = (7 - firstDayDow + this.settings.firstDayOfTheWeekIndex) % 7;
      if (daysInFirstWeek === 0) daysInFirstWeek = 7;
      daysInPreviousMonth = lastDayOfPreviousMonth.getDate();
      date = new Date(cd.getFullYear(), cd.getMonth(), daysInFirstWeek - 6);
      daysInMonth = (new Date(cd.getFullYear(), cd.getMonth() + 1, 0)).getDate();
      weeks = Math.ceil((daysInMonth + 7 - daysInFirstWeek) / 7.0);
      renderDay = function(day) {
        var classAttribute, classes, liContent;
        classes = [];
        classAttribute = '';
        liContent = day.getDate();
        if (day.getMonth() !== cd.getMonth()) {
          classes.push(lw_dp_neighbour_month_day_class);
        }
        if (day.getDay() === 0 || day.getDay() === 6) {
          classes.push(lw_dp_weekend_class);
        }
        if (day.getDay() === lastDowIndex) {
          classes.push(lw_dp_week_last_column_class);
        }
        if (compareDates(day, _this.todayDate) === 0) {
          classes.push(lw_dp_today_class);
          liContent = "<span>" + liContent + "</span>";
        }
        if ((_this.activeDate != null) && compareDates(day, _this.activeDate) === 0) {
          classes.push(lw_dp_active_day_class);
        }
        if (!_this._isDateInsidePeriod(date)) {
          classes.push(lw_dp_out_of_interval_class);
          liContent = '';
        }
        if (classes.length) {
          classAttribute = " class='" + (classes.join(" ")) + "'";
        }
        day.setDate(day.getDate() + 1);
        return "<li" + classAttribute + ">" + liContent + "</li>";
      };
      html = '';
      for (week = _i = 1; 1 <= weeks ? _i <= weeks : _i >= weeks; week = 1 <= weeks ? ++_i : --_i) {
        if (week === 1) {
          html += "<ul class='" + lw_dp_week_class + " " + lw_dp_firstweek_class + "'>";
        } else if (week === weeks) {
          html += "<ul class='" + lw_dp_week_class + " " + lw_dp_lastweek_class + "'>";
        } else {
          html += "<ul class=" + lw_dp_week_class + ">";
        }
        for (day = _j = 1; _j <= 7; day = ++_j) {
          html += renderDay(date);
        }
        html += '</ul>';
      }
      return this.days.html(html);
    };

    LightweightDatepicker.prototype.setActiveDate = function(date) {
      var activeLi, oldDate;
      if (!isDateValid(date)) return false;
      if (!this._isDateInsidePeriod(date)) return false;
      oldDate = this.activeDate;
      this.activeDate = date;
      this.setCurrentDate(date);
      this.updateInput();
      if ((oldDate != null) && (date.getFullYear() === oldDate.getFullYear() && date.getMonth() === oldDate.getMonth())) {
        this.days.find("li." + lw_dp_active_day_class).removeClass(lw_dp_active_day_class);
        activeLi = this.days.find("li:not(." + lw_dp_neighbour_month_day_class + ")").filter(function() {
          return parseInt($(this).text(), 10) === date.getDate();
        });
        return activeLi.addClass(lw_dp_active_day_class);
      }
    };

    LightweightDatepicker.prototype.setCurrentDate = function(date) {
      this.currentDate = date;
      return this._updateMonth();
    };

    LightweightDatepicker.prototype._isDateInsidePeriod = function(date) {
      if ((this.settings.startDate != null) && (compareDates(date, this.settings.startDate) === -1)) {
        return false;
      }
      if ((this.settings.endDate != null) && (compareDates(date, this.settings.endDate) === 1)) {
        return false;
      }
      return true;
    };

    LightweightDatepicker.prototype._parseDate = function(string) {
      if (typeof this.settings.parseDate === 'function') {
        return this.settings.parseDate(string);
      } else {
        return new Date(Date.parse(string));
      }
    };

    LightweightDatepicker.prototype._formatDate = function(date) {
      if (!isDateValid(date)) return;
      if (typeof this.settings.formatDate === 'function') {
        return this.settings.formatDate(date);
      } else {
        if (date != null) {
          return (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
        } else {
          return '';
        }
      }
    };

    LightweightDatepicker.prototype._renderDows = function() {
      var day, first, found, html, name, temp, _i, _len, _ref;
      first = this.settings.dowNames[this.settings.firstDayOfTheWeekIndex];
      found = false;
      html = "<ul class=" + lw_dp_dows_class + ">";
      temp = '';
      _ref = this.settings.dowNames;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        name = _ref[_i];
        if (name === first) found = true;
        day = "<li>" + name + "</li>";
        if (found) {
          html += day;
        } else {
          temp += day;
        }
      }
      html += temp;
      html += '</ul>';
      return $(html);
    };

    LightweightDatepicker.prototype.updatePosition = function() {
      var inputOffset, left, top, wrapperOuterHeight, wrapperOuterWidth;
      if (this.settings.alwaysVisible) {
        inputOffset = this.input.position();
      } else {
        inputOffset = this.input.offset();
      }
      wrapperOuterWidth = this.wrapper.outerWidth();
      wrapperOuterHeight = this.wrapper.outerHeight();
      left = inputOffset.left;
      if ($('body').width() > left + wrapperOuterWidth) {
        this.wrapper.css({
          'left': left
        });
      } else {
        if (inputOffset.left > wrapperOuterWidth + this.margin) {
          this.wrapper.css({
            'left': $('body').width() - wrapperOuterWidth + this.margin
          });
        } else {
          this.wrapper.css({
            'left': left
          });
        }
      }
      this.wrapper.removeClass('lw-dp-opposite-vertical');
      top = inputOffset.top + this.input.outerHeight() + this.margin;
      if ($(document).height() > top + wrapperOuterHeight) {
        return this.wrapper.css({
          'top': top
        });
      } else {
        if (inputOffset.top > wrapperOuterHeight + this.margin) {
          this.wrapper.css({
            'top': inputOffset.top - wrapperOuterHeight - this.margin
          });
          return this.wrapper.addClass('lw-dp-opposite-vertical');
        } else {
          return this.wrapper.css({
            'top': top
          });
        }
      }
    };

    LightweightDatepicker.prototype.hide = function() {
      var _ref;
      if (!this.settings.alwaysVisible && this.shouldHide) this.wrapper.detach();
      if (!this.shouldHide) if ((_ref = this.input) != null) _ref.focus();
      return this.shouldHide = true;
    };

    LightweightDatepicker.prototype.show = function() {
      if (!this.settings.alwaysVisible) this.wrapper.appendTo(document.body);
      this.updatePosition();
      return this._updateMonth();
    };

    LightweightDatepicker.prototype.showPreviousMonth = function() {
      return this.setCurrentDate(new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() - 1, this.currentDate.getDate()));
    };

    LightweightDatepicker.prototype.showNextMonth = function() {
      return this.setCurrentDate(new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, this.currentDate.getDate()));
    };

    LightweightDatepicker.prototype._handleKeyDown = function(e) {
      var handled, keyCode, newDate, selectionEnd, selectionStart;
      keyCode = e.keyCode;
      handled = true;
      selectionStart = this.input[0].selectionStart;
      selectionEnd = this.input[0].selectionEnd;
      switch (keyCode) {
        case 27:
          this.input.blur();
          return false;
        case 33:
          newDate = new Date(this.activeDate.getFullYear(), this.activeDate.getMonth() - 1, this.activeDate.getDate());
          while (newDate.getMonth() === this.activeDate.getMonth()) {
            newDate.setDate(newDate.getDate() - 1);
          }
          this.setActiveDate(newDate);
          break;
        case 34:
          newDate = new Date(this.activeDate.getFullYear(), this.activeDate.getMonth() + 1, this.activeDate.getDate());
          while (newDate.getMonth() === this.activeDate.getMonth() + 2) {
            newDate.setDate(newDate.getDate() - 1);
          }
          this.setActiveDate(newDate);
          break;
        case 38:
          this.setActiveDate(new Date(this.activeDate.getFullYear(), this.activeDate.getMonth(), this.activeDate.getDate() - 1));
          break;
        case 40:
          this.setActiveDate(new Date(this.activeDate.getFullYear(), this.activeDate.getMonth(), this.activeDate.getDate() + 1));
          break;
        default:
          handled = false;
      }
      this.input[0].selectionStart = selectionStart;
      this.input[0].selectionEnd = selectionEnd;
      return !handled;
    };

    LightweightDatepicker.prototype.destroy = function() {
      this.toolbar.undelegate();
      this.days.undelegate();
      this.input.unbind('focus', this.show);
      this.input.unbind('blur', this.hide);
      this.input.unbind('keydown', this._handleKeyDown);
      this.input.unbind('change', this._onChange);
      this.input.unbind('click', this._onClick);
      this.input.data(lw_dp_data_key, null);
      return this.input = null;
    };

    return LightweightDatepicker;

  })();

  $.fn['lwDatepicker'] = function(options) {
    options = $.extend({}, settings, options);
    return this.each(function() {
      var $el;
      $el = $(this);
      if (($el.is('input, textarea')) && !$el.data(lw_dp_data_key)) {
        return new LightweightDatepicker($el, options);
      }
    });
  };

  $.fn['lwDatepicker']['setDefaultOptions'] = function(options) {
    if (options == null) options = {};
    return settings = $.extend(settings, options);
  };

}).call(this);

// Infrastructure/Dates.js
(function () {
    TF = window.TF || {};
    TF.Dates = {};
    var dates = TF.Dates;

    dates.format = 'dd/mm/yy';
    
    function getDaysInMonth(year, month) {
        return 32 - daylightSavingAdjust(new Date(year, month, 32)).getDate();
    };

    function daylightSavingAdjust(date) {
        if (!date) return null;
        date.setHours(date.getHours() > 12 ? date.getHours() + 2 : 0);
        return date;
    };

    var shortYearCutoff = '+10';
    var dayNamesShort = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    var dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    var monthNamesShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    dates.tryParseDate = function (value, format) {
        try {
            return dates.parseDate(value, format);
        } catch (e) {
            return null;
        }
    };

    dates.parseDate = function (value, format) {
        if (!value)
            throw 'Invalid arguments';
        if (!format)
            format = dates.format;
        value = (typeof value == 'object' ? value.toString() : value + '');
        if (value == '')
            return null;
        var year = -1;
        var month = -1;
        var day = -1;
        var doy = -1;
        var literal = false;
        // Check whether a format character is doubled
        var lookAhead = function (match) {
            var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) == match);
            if (matches)
                iFormat++;
            return matches;
        };
        // Extract a number from the string value
        var getNumber = function (match) {
            var isDoubled = lookAhead(match);
            var size = (match == '@' ? 14 : (match == '!' ? 20 :
                (match == 'y' && isDoubled ? 4 : (match == 'o' ? 3 : 2))));
            var digits = new RegExp('^\\d{1,' + size + '}');
            var num = value.substring(iValue).match(digits);
            if (!num)
                throw 'Missing number at position ' + iValue;
            iValue += num[0].length;
            return parseInt(num[0], 10);
        };
        // Extract a name from the string value and convert to an index
        var getName = function (match, shortNames, longNames) {
            var names = $.map(lookAhead(match) ? longNames : shortNames, function (v, k) {
                return [[k, v]];
            }).sort(function (a, b) {
                return -(a[1].length - b[1].length);
            });
            var index = -1;
            $.each(names, function (i, pair) {
                var name = pair[1];
                if (value.substr(iValue, name.length).toLowerCase() == name.toLowerCase()) {
                    index = pair[0];
                    iValue += name.length;
                    return false;
                }
            });
            if (index != -1)
                return index + 1;
            else
                throw 'Unknown name at position ' + iValue;
        };
        // Confirm that a literal character matches the string value
        var checkLiteral = function () {
            if (value.charAt(iValue) != format.charAt(iFormat))
                throw 'Unexpected literal at position ' + iValue;
            iValue++;
        };
        var iValue = 0;
        for (var iFormat = 0; iFormat < format.length; iFormat++) {
            if (literal)
                if (format.charAt(iFormat) == "'" && !lookAhead("'"))
                    literal = false;
                else
                    checkLiteral();
            else
                switch (format.charAt(iFormat)) {
                    case 'd':
                        day = getNumber('d');
                        break;
                    case 'D':
                        getName('D', dayNamesShort, dayNames);
                        break;
                    case 'o':
                        doy = getNumber('o');
                        break;
                    case 'm':
                        month = getNumber('m');
                        break;
                    case 'M':
                        month = getName('M', monthNamesShort, monthNames);
                        break;
                    case 'y':
                        year = getNumber('y');
                        break;
                    case '@':
                        var date = new Date(getNumber('@'));
                        year = date.getFullYear();
                        month = date.getMonth() + 1;
                        day = date.getDate();
                        break;
                    case '!':
                        var date = new Date((getNumber('!') - this._ticksTo1970) / 10000);
                        year = date.getFullYear();
                        month = date.getMonth() + 1;
                        day = date.getDate();
                        break;
                    case "'":
                        if (lookAhead("'"))
                            checkLiteral();
                        else
                            literal = true;
                        break;
                    default:
                        checkLiteral();
                }
        }
        if (iValue < value.length) {
            throw "Extra/unparsed characters found in date: " + value.substring(iValue);
        }
        if (year == -1)
            year = new Date().getFullYear();
        else if (year < 100)
            year += new Date().getFullYear() - new Date().getFullYear() % 100 +
                (year <= shortYearCutoff ? 0 : -100);
        if (doy > -1) {
            month = 1;
            day = doy;
            do {
                var dim = getDaysInMonth(year, month - 1);
                if (day <= dim)
                    break;
                month++;
                day -= dim;
            } while (true);
        }
        var date = daylightSavingAdjust(new Date(year, month - 1, day));
        if (date.getFullYear() != year || date.getMonth() + 1 != month || date.getDate() != day)
            throw 'Invalid date';
        return date;
    };

    dates.formatDate = function (date, format) {
        if (!format)
            format = dates.format;
        if (!date)
            return '';
        if (date.constructor === String)
            date = dates.parseDate(date, format);

        // Check whether a format character is doubled
        var lookAhead = function (match) {
            var matches = (iFormat + 1 < format.length && format.charAt(iFormat + 1) == match);
            if (matches)
                iFormat++;
            return matches;
        };
        // Format a number, with leading zero if necessary
        var formatNumber = function (match, value, len) {
            var num = '' + value;
            if (lookAhead(match))
                while (num.length < len)
                    num = '0' + num;
            return num;
        };
        // Format a name, short or long as requested
        var formatName = function (match, value, shortNames, longNames) {
            return (lookAhead(match) ? longNames[value] : shortNames[value]);
        };
        var output = '';
        var literal = false;
        if (date)
            for (var iFormat = 0; iFormat < format.length; iFormat++) {
                if (literal)
                    if (format.charAt(iFormat) == "'" && !lookAhead("'"))
                        literal = false;
                    else
                        output += format.charAt(iFormat);
                else
                    switch (format.charAt(iFormat)) {
                        case 'd':
                            output += formatNumber('d', date.getDate(), 2);
                            break;
                        case 'D':
                            output += formatName('D', date.getDay(), dayNamesShort, dayNames);
                            break;
                        case 'o':
                            output += formatNumber('o',
                                Math.round((new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime() - new Date(date.getFullYear(), 0, 0).getTime()) / 86400000), 3);
                            break;
                        case 'm':
                            output += formatNumber('m', date.getMonth() + 1, 2);
                            break;
                        case 'M':
                            output += formatName('M', date.getMonth(), monthNamesShort, monthNames);
                            break;
                        case 'y':
                            output += (lookAhead('y') ? date.getFullYear() :
                                (date.getYear() % 100 < 10 ? '0' : '') + date.getYear() % 100);
                            break;
                        case '@':
                            output += date.getTime();
                            break;
                        case '!':
                            output += date.getTime() * 10000 + this._ticksTo1970;
                            break;
                        case "'":
                            if (lookAhead("'"))
                                output += "'";
                            else
                                literal = true;
                            break;
                        default:
                            output += format.charAt(iFormat);
                    }
            }
        return output;
    };
})();

// Infrastructure/observableExtensions.js
(function () {
    // adds setWithoutValidation to observables
    var oldExtender = ko.extenders['validatable'];
    ko.extenders['validatable'] = function (observable, enable) {
        oldExtender(observable, enable);
        observable.setWithoutValidation = setWithoutValidation;
    };

    function setWithoutValidation(value) {
        var rules = observable.rules();
        observable.rules([]);
        observable(value);
        observable.isModified(false);
        observable.rules(rules);
    }
})();
// Infrastructure/templates.js
TF = window.TF || {};
TF.renderTemplate = function (name, target) {
    $(target).empty().append($('head script#template--Forms-' + name).html());
};
// Infrastructure/Utils.js
TF = window.TF || {};
TF.Utils = {};

TF.Utils.normaliseBindings = function (valueAccessor, allBindingsAccessor) {
    var data = allBindingsAccessor();
    data.value = valueAccessor();
    if (!ko.isObservable(data.value) && $.isFunction(data.value))
        data.value = data.value();
    return data;
};

TF.Utils.evaluateProperty = function (target, property, defaultValue) {
    var properties = property.match(/[^\.]+/g);
    var result = target;

    if (properties) {
        for (var i = 0, l = properties.length; i < l; i++) {
            var current = result[properties[i]];
            if (current)
                result = current;
            else if (defaultValue) {
                result[properties[i]] = i < (l - 1) ? {} : defaultValue;
                result = result[properties[i]];
            } else
                return undefined;
        }
    }
    return result;
};

TF.Utils.cloneData = function (from, except) {
    var result = {};
    for (var property in from) {
        var value = from[property];
        if (from.hasOwnProperty(property) &&
            (!except || Array.prototype.indexOf.call(arguments, property) === -1) &&
            (!value || (value.constructor !== Function || ko.isObservable(value))))

            result[property] = ko.utils.unwrapObservable(value);
    }
    return result;
};
// Infrastructure/validationRules.js
ko.validation.rules['date'] = {
    validator: function (value, validate) {
        return !value || (validate && TF.Dates.tryParseDate(value));
    },
    message: 'Please enter a proper date'
};
// BindingHandlers/fields.js
(function () {
    addBindingHandler('display');
    addBindingHandler('textField');
    addBindingHandler('dateField');
    addBindingHandler('passwordField');
    addBindingHandler('selectField');
    addBindingHandler('radioField');
    addBindingHandler('booleanField');

    ko.bindingHandlers.field = {
        update: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
            var properties = valueAccessor();
            renderFieldTemplate(properties.type + 'Field', element, function () { return properties.value; }, valueAccessor, viewModel, bindingContext);
        }
    };

    function addBindingHandler(name) {
        ko.bindingHandlers[name] = {
            init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
                renderFieldTemplate(name, element, valueAccessor, allBindingsAccessor, viewModel, bindingContext);
                return { controlsDescendantBindings: true };
            }
        };
    }

    function renderFieldTemplate(templateName, element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
        var data = TF.Utils.normaliseBindings(valueAccessor, allBindingsAccessor);
        if(bindingContext.__create) resolveStringValue();

        var innerBindingContext = bindingContext.extend(data);
        ko.applyBindingsToDescendants(innerBindingContext, element);

        TF.renderTemplate(templateName, element);
        fieldSpecificSetup();
        ko.applyBindingsToDescendants(data, element);
            
        var inputs = $(element).find('input');
        setIdAttribute();
        setFocus();
        clickFirstButtonOnEnterKey();

        function resolveStringValue() {
            if (data.value.constructor === String) {
                var defaultValue;
                if (bindingContext.__create) defaultValue = ko.observable(data.defaultValue).extend(data.validate);
                var evaluatedValue = TF.Utils.evaluateProperty(viewModel, data.value, defaultValue);
                data.value = evaluatedValue;
            }
        }

        // this is a bit of a hack
        function setFocus() {
            if (data.isDefault)
                setTimeout(function () {
                    inputs.focus();
                }, 100);
        }

        // this has got to work outside of Tribe...
        function clickFirstButtonOnEnterKey() {
            if (viewModel && viewModel.__node)
                inputs.keyup(function (event) {
                    if (event.which === 13) {
                        $(event.target).change().blur();
                        
                        var clickTarget = $(element).closest('.form').find('button:eq(0)');
                        if(clickTarget.length === 0 && viewModel.__node)
                            clickTarget = $(viewModel.__node.pane.element).find('button:eq(0)');
                        clickTarget.click();
                    }
                });
        }

        // it would be nicer if we could use the attr { id: id } binding in knockout, but the jQuery UI datepicker sets the id of elements, the attr binding then resets it.
        function setIdAttribute() {
            inputs.eq(0).attr('id', data.id);
        }
        
        // yeh, this is pretty nasty... If more code is added here, this should be refactored.
        function fieldSpecificSetup() {
            switch(templateName) {
                case 'dateField':
                    $('.datePicker').lwDatepicker({ parseDate: TF.Dates.tryParseDate, formatDate: TF.Dates.formatDate, autoHideAfterClick: true });
                    break;
            }
        }
    };
})();
// BindingHandlers/focus.js
ko.bindingHandlers.focus = {
    update: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
        var context = viewModel.__context || bindingContext.$root.__context;
        if (context)
            $.when(context.renderOperation.promise).done(function () {
                setTimeout(function() {
                    $(element).focus();
                }, 100);
            });
    }
};
// BindingHandlers/form.js
ko.bindingHandlers.form = {
    init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
        var data = TF.Utils.normaliseBindings(valueAccessor, allBindingsAccessor);
        data.value = data.value || {};
        
        if (data.value.constructor === String) {
            var defaultValue = data.create ? {} : undefined;
            data.value = TF.Utils.evaluateProperty(viewModel, data.value, defaultValue);
        }

        var childContext = bindingContext.createChildContext(data.value);
        if (data.create) childContext.__create = true;
        ko.applyBindingsToDescendants(childContext, element);

        return { controlsDescendantBindings: true };
    }
};
// BindingHandlers/navigate.js
ko.bindingHandlers.navigate = {
    init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
        if (!TC) return;
        var node = TC.nodeFor(element);
        if (!node) return;

        ko.bindingHandlers.validatedClick.init(element, navigate, allBindingsAccessor, viewModel);

        function navigate() {
            return function() {
                node.navigate(valueAccessor(), TF.Utils.cloneData(viewModel));
            };
        }
    }
};
// BindingHandlers/publish.js
ko.bindingHandlers.publish = {
    init: function (element, valueAccessor, allBindingsAccessor, viewModel, bindingContext) {
        if (!TC) return;
        var pubsub = TC.nodeFor(element).pane.pubsub;
        if (!pubsub) return;

        ko.bindingHandlers.validatedClick.init(element, publishAccessor, allBindingsAccessor, viewModel);

        function publishAccessor() {
            return function() {
                pubsub.publish(valueAccessor(), TF.Utils.cloneData(viewModel));
            };
        }
    }
};
// BindingHandlers/select.js
(function () {
    ko.bindingHandlers.select = {
        update: function (element, valueAccessor, allBindingsAccessor) {
            var value = valueAccessor();
            var bindings = allBindingsAccessor();
            var source = ko.utils.unwrapObservable(bindings.source);
            var displayList = bindings.property ?
                _.map(source, function(item) {
                    return item[bindings.property];
                }) : 
                source.slice(0);

            displayList.splice(0, 0, [bindings.initialText || 'Select...']);

            setTimeout(function() {
                TF.renderTemplate('/Templates/select.list', element);
                ko.applyBindings({ source: displayList, change: change }, element.children[0]);
            });
            
            function change(binding, event) {
                var index = $(event.target).find('option:selected').index();
                if(ko.isObservable(value))
                    value(index ? source[index - 1] : null);
            }
        }
    };

    ko.bindingHandlers.label = {
        update: function (element, valueAccessor) {
            $(element).attr('label', ko.utils.unwrapObservable(valueAccessor()));
        }
    };
})();
// BindingHandlers/validatedClick.js
(function() {
    ko.bindingHandlers.validatedClick = {
        'init': function (element, valueAccessor, allBindingsAccessor, viewModel) {
            var newValueAccessor = function() {
                return validatedClick;
            };
            return ko.bindingHandlers.click.init(element, newValueAccessor, allBindingsAccessor, viewModel);

            function validatedClick(arg) {
                // knockout validation adds some properties to the object, clone so we don't affect the original
                var target = $.extend({}, arg);
                
                // we also want to ignore Tribe embedded properties or they cause the validator to loop infinitely
                delete target.__context;
                delete target.__node;
                
                var errors = ko.validation.group(target, { deep: true });
                if (errors().length > 0)
                    errors.showAllMessages();
                else
                    valueAccessor()(arg);
            }
        }
    };
})();
// BindingHandlers/validationMessage.tooltip.js
//ko.bindingHandlers['validationMessage'] = {
//    init: function (element, valueAccessor) {
//        var id = uuid.v4();
//        var observable = valueAccessor();
//        var $parent = $(element).parent();
//        var $targetElement;

//        if ($parent.hasClass('display'))
//            $targetElement = $parent.parent().parent();
//        else {
//            var $prev = $(element).prev();
//            $targetElement = $prev.attr('type') === 'hidden' ? $prev.prev() : $prev;
//        }
//        var error = ko.observable();
//        var pane = TC.insertNodeAfter($targetElement, {
//            path: '/Common/tooltip',
//            data: { html: error, position: 'auto', target: $targetElement, timeout: 3000, topic: id }
//        });
//        $targetElement.next().addClass('validationMessage');
//        observable.subscribe(function () {
//            if (observable.isModified && observable.isModified()) {
//                TC.context().pubsub.publish(observable.isValid() ? 'tooltip.hide' : 'tooltip.show', { topic: id, immediate: true });
//                error(observable.error);
//            }
//        });
//        return { controlsDescendantBindings: true };
//    }
//};

$('head')
    .append('<script type="text/template" id="template--Forms-booleanField"><div class="field">\n    <div class="label">\n        <span data-bind="text: $data.displayText"></span>\n    </div>\n    <div class="display">\n        <input type="checkbox" data-bind="checked: value" />\n    </div>\n    <div style="clear: both"></div>\n</div>\n</script>');
$('head')
    .append('<script type="text/template" id="template--Forms-dateField"><div class="field">\n    <div class="label">\n        <span data-bind="text: $data.displayText"></span>\n    </div>\n    <div class="display">\n        <input type="text" class="datePicker" data-bind="value: value, restrictKeys: \'[^0-9\\/]+\'" />\n    </div>\n    <div style="clear: both"></div>\n</div></script>');
$('head')
    .append('<script type="text/template" id="template--Forms-display"><div class="field">\n    <div class="label">\n        <span data-bind="text: $data.displayText"></span>\n    </div>\n    <div class="display">\n        <span data-bind="text: value"></span>\n    </div>\n    <div style="clear: both"></div>\n</div></script>');
$('head')
    .append('<script type="text/template" id="template--Forms-passwordField"><div class="field">\n    <div class="label">\n        <span data-bind="text: $data.displayText"></span>\n    </div>\n    <div class="display">\n        <input type="password" data-bind="value: value"></input>\n    </div>\n    <div style="clear: both"></div>\n</div></script>');
$('head')
    .append('<script type="text/template" id="template--Forms-radioField"><div class="field">\n    <div class="label">\n        <span data-bind="text: $data.displayText"></span>\n    </div>\n    <div class="display" data-bind="foreach: items">\n        <label>\n            <input type="radio" data-bind="value: $data, checked: $parent.value, attr: { name: $parent.displayText.replace(/ /g, \'_\') }" />\n            <span data-bind="text: $data"></span>\n        </label>\n        &nbsp;\n    </div>\n    <div style="clear: both"></div>\n</div></script>');
$('head')
    .append('<script type="text/template" id="template--Forms-selectField"><div class="field">\n    <div class="label">\n        <span data-bind="text: $data.displayText"></span>\n    </div>\n    <div class="display">\n        <select data-bind="options: items, value: value, optionsText: $data.optionsText"></select>\n    </div>\n    <div style="clear: both"></div>\n</div></script>');
$('head')
    .append('<script type="text/template" id="template--Forms-textField"><div class="field">\n    <div class="label">\n        <span data-bind="text: $data.displayText"></span>\n    </div>\n    <div class="display">\n        <input type="text" data-bind="value: value" />\n    </div>\n    <div style="clear: both"></div>\n</div></script>');
$('head')
    .append('<script type="text/template" id="template--Forms-validationMessage"><div data-bind="pane: \'/Common/tooltip\', data: { html: $data.field.error, autoShow: true, position: \'right\' }"></div></script>');
$('<style/>')
    .attr('class', '__tribe')
    .text('.lw-dp{position:absolute;z-index:100;overflow:hidden;cursor:default;width:141px;border-width:1px;border-style:solid;padding:4px;margin:5.5px;background:#45484d;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzQ1NDg0ZCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDAwMDAiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);background:-moz-linear-gradient(top,rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(69,72,77,1)),color-stop(100%,rgba(0,0,0,1)));background:-webkit-linear-gradient(top,rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);background:-o-linear-gradient(top,rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);background:-ms-linear-gradient(top,rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);background:linear-gradient(top,rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#45484d\',endColorstr=\'#000000\',GradientType=0);border-radius:6px;-moz-border-radius:6px;-webkit-border-radius:6px;box-shadow:3px 3px 3px rgba(0,0,0,.3);-moz-box-shadow:3px 3px 3px rgba(0,0,0,.3);-webkit-box-shadow:3px 3px 3px rgba(0,0,0,.3);-moz-user-select:none;-webkit-user-select:none;-o-user-select:none;user-select:none}.lw-dp-hidden{display:none;box-shadow:none}.lw-dp-toolbar{text-align:center;overflow:hidden;font-size:12px;line-height:18px;color:#ddd;padding:0 0 2.2px}.lw-dp-month{display:inline-block;width:103px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.lw-dp-previous,.lw-dp-next{position:absolute;overflow:hidden;top:8px;width:0;height:0;color:#ddd;cursor:pointer;border-top:5.938px solid transparent;border-bottom:5.938px solid transparent}.lw-dp-previous{left:8px;border-right:11.875px solid #ddd}.lw-dp-next{right:8px;border-left:11.875px solid #ddd}.lw-dp-previous:hover{border-right-color:#797979}.lw-dp-next:hover{border-left-color:#797979}.lw-dp-previous:active{border-right-color:#acacac}.lw-dp-next:active{border-left-color:#acacac}.lw-dp-dows{padding:0;margin:0;overflow:hidden}.lw-dp-dows li,.lw-dp-week li{display:block;float:left;padding:0;margin:0;text-align:center;color:#fff}.lw-dp-dows li{font-size:9px;line-height:7.7px;width:20px;height:10px;padding:0;margin:0}.lw-dp-week{padding:0;margin:0;overflow:hidden}.lw-dp-week li{padding:0;margin:0;border-width:0;font-size:11px;color:#000;width:19px;height:19px;line-height:19px;background:#e0e0e0;border-left-width:1px;border-top-width:1px;border-style:solid;border-color:#f9f9f9;cursor:pointer}.lw-dp-dows-last-column,.lw-dp-week-last-column{border-right-width:1px}.lw-dp-lastweek li{padding:0;margin:0;border-bottom-width:1px}.lw-dp-firstweek li:first-child{-moz-border-radius:4px 0 0 0;-webkit-border-radius:4px 0 0 0;-o-border-radius:4px 0 0 0;-ms-border-radius:4px 0 0 0;-khtml-border-radius:4px 0 0 0;border-radius:4px 0 0 0}.lw-dp-firstweek li:last-child{-moz-border-radius:0 4px 0 0;-webkit-border-radius:0 4px 0 0;-o-border-radius:0 4px 0 0;-ms-border-radius:0 4px 0 0;-khtml-border-radius:0 4px 0 0;border-radius:0 4px 0 0}.lw-dp-lastweek li:first-child{-moz-border-radius:0 0 0 4px;-webkit-border-radius:0 0 0 4px;-o-border-radius:0 0 0 4px;-ms-border-radius:0 0 0 4px;-khtml-border-radius:0 0 0 4px;border-radius:0 0 0 4px}.lw-dp-lastweek li:last-child{-moz-border-radius:0 0 4px 0;-webkit-border-radius:0 0 4px 0;-o-border-radius:0 0 4px 0;-ms-border-radius:0 0 4px 0;-khtml-border-radius:0 0 4px 0;border-radius:0 0 4px 0}.lw-dp-week li:hover{background:#f4f4f4}li.lw-dp-weekend{background:#d0d0d0}li.lw-dp-today{-moz-border-radius:2px;-webkit-border-radius:2px;-o-border-radius:2px;-ms-border-radius:2px;-khtml-border-radius:2px;border-radius:2px}li.lw-dp-today span{display:block;width:17px;height:17px;line-height:17px;border:1px solid #acacac;-moz-border-radius:2px;-webkit-border-radius:2px;-o-border-radius:2px;-ms-border-radius:2px;-khtml-border-radius:2px;border-radius:2px}li.lw-dp-today:hover span{color:#797979}li.lw-dp-active-day,li.lw-dp-active-day:hover{position:relative;color:#f9f9f9;background:#797979}li.lw-dp-active-day:nth-child(n),li.lw-dp-active-day:hover:nth-child(n){background:none}li.lw-dp-active-day::before,li.lw-dp-active-day:hover::before{position:absolute;left:0;top:0;bottom:0;right:0;content:\'\';-moz-border-radius:2px;-webkit-border-radius:2px;-o-border-radius:2px;-ms-border-radius:2px;-khtml-border-radius:2px;border-radius:2px;background:#797979;z-index:-1}li.lw-dp-active-day:hover span{background:#e0e0e0}li.lw-dp-neighbour-month-day{color:#b9b9b9}li.lw-dp-out-of-interval,li.lw-dp-out-of-interval:hover{background:#ececec;cursor:default}')
    .appendTo('head');
$('<style/>')
    .attr('class', '__tribe')
    .text('.field{clear:left;padding-top:5px}.label{float:left;width:150px}.display{float:left;position:relative}.fieldColumn{float:left}.fieldColumn:nth-child(n+2){padding-left:20px}.validationMessage{display:inline;color:#fa8072}.validationMessage .tooltipContent{padding:1px 5px;border:1px solid #4f0707;white-space:nowrap;background:#ad1111}.desktop .validationMessage .tooltipContent{background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2FkMTExMSIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiM0ZjA3MDciIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);background:-moz-linear-gradient(top,rgba(173,17,17,1) 0%,rgba(79,7,7,1) 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(173,17,17,1)),color-stop(100%,rgba(79,7,7,1)));background:-webkit-linear-gradient(top,rgba(173,17,17,1) 0%,rgba(79,7,7,1) 100%);background:-o-linear-gradient(top,rgba(173,17,17,1) 0%,rgba(79,7,7,1) 100%);background:-ms-linear-gradient(top,rgba(173,17,17,1) 0%,rgba(79,7,7,1) 100%);background:linear-gradient(top,rgba(173,17,17,1) 0%,rgba(79,7,7,1) 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=\'#ad1111\',endColorstr=\'#4f0707\',GradientType=0)}.validationElement{border:2px solid red!important}')
    .appendTo('head');
$('<style/>')
    .attr('class', '__tribe')
    .text('.TM .field{width:100%;margin-bottom:5px}.TM .label{font-size:.7em}.TM .display{width:100%}.TM .display input{width:100%}.TM .fieldColumn{float:left}.TM .fieldColumn:nth-child(n+2){padding-left:20px}.TM .validationElement{border:2px solid red!important}')
    .appendTo('head');
