window.Tribe=window.Tribe||{},window.Tribe.PubSub=function(n){function f(n){function e(t){var i=u("exceptionHandler");if(u("handleExceptions"))try{t(n.data,n)}catch(r){i&&i(r,n)}else t(n.data,n)}for(var f=t.get(n.topic),o=n.sync===!0||i.sync===!0,r=0;r<f.length;r++)o?e(f[r].handler):function(n){setTimeout(function(){e(n.handler)})}(f[r])}function u(t){return n&&n.hasOwnProperty(t)?n[t]:Tribe.PubSub.options[t]}var i=this,r=Tribe.PubSub.utils,t;this.owner=this,this.sync=u("sync"),t=new Tribe.PubSub.SubscriberList,this.subscribers=t,this.publish=function(n,t){var i=n&&n.topic?n:{topic:n,data:t,sync:!1};return f(i)},this.publishSync=function(n,t){return f({topic:n,data:t,sync:!0})},this.subscribe=function(n,i){return typeof n=="string"?t.add(n,i):r.isArray(n)?r.map(n,function(n){return t.add(n,i)}):r.map(n,function(n,i){return t.add(i,n)})},this.unsubscribe=function(n){var r,i;if(Tribe.PubSub.utils.isArray(n)){for(r=[],i=0;i<n.length;i++)r.push(t.remove(n[i]));return r}return t.remove(n)},this.createLifetime=function(){return new Tribe.PubSub.Lifetime(i,i)}},Tribe.PubSub.Lifetime=function(n,t){function u(n){return Tribe.PubSub.utils.isArray(n)?i=i.concat(n):i.push(n),n}var r=this,i=[];this.owner=t,this.publish=function(t,i){return n.publish(t,i)},this.publishSync=function(t,i){return n.publishSync(t,i)},this.subscribe=function(t,i){var r=n.subscribe(t,i);return u(r)},this.subscribeOnce=function(t,i){var r=n.subscribeOnce(t,i);return u(r)},this.unsubscribe=function(t){return n.unsubscribe(t)},this.end=function(){return n.unsubscribe(i)},this.createLifetime=function(){return new Tribe.PubSub.Lifetime(r,r.owner)}},window.Tribe.PubSub.options={sync:!1,handleExceptions:!0,exceptionHandler:function(n,t){console.log("Exception occurred in subscriber to '"+t.topic+"': "+n.message)}},Tribe.PubSub.prototype.subscribeOnce=function(n,t){function e(){var i={};return r.each(n,function(n){i[n]=u(t)}),i}function o(){return r.map(n,function(n,t){return i.subscribe(t,u(n))})}function u(n){return function(){i.end(),n.apply(f,arguments)}}var f=this,r=Tribe.PubSub.utils,i=this.createLifetime();return typeof n=="string"?i.subscribe(n,u(t)):r.isArray(n)?i.subscribe(e()):i.subscribe(o())},Tribe.PubSub.SubscriberList=function(){function i(n,t){if(t==="*")return!0;var i="^"+t.replace(/\./g,"\\.").replace(/\*/g,"[^.]*")+"$";return n.match(i)}var n={},t=-1;this.get=function(t){var u=[],r;for(r in n)n.hasOwnProperty(r)&&i(t,r)&&(u=u.concat(n[r]));return u},this.add=function(i,r){var u=(++t).toString();return n.hasOwnProperty(i)||(n[i]=[]),n[i].push({topic:i,handler:r,token:u}),u},this.remove=function(t){var i,r,u;for(i in n)if(n.hasOwnProperty(i))for(r=0,u=n[i].length;r<u;r++)if(n[i][r].token===t)return n[i].splice(r,1),t;return!1}},Tribe.PubSub.utils={},function(n){n.isArray=function(n){return n.constructor===Array};var t=Array.prototype.forEach,i=Array.prototype.map,r={};n.each=function(n,i,u){var f,o,e;if(n!=null)if(t&&n.forEach===t)n.forEach(i,u);else if(n.length===+n.length){for(f=0,o=n.length;f<o;f++)if(i.call(u,n[f],f,n)===r)return}else for(e in n)if(n.hasOwnProperty(e)&&i.call(u,n[e],e,n)===r)return},n.map=function(t,r,u){var f=[];return t==null?f:i&&t.map===i?t.map(r,u):(n.each(t,function(n,t,i){f[f.length]=r.call(u,n,t,i)}),f)}}(Tribe.PubSub.utils);